window.jQuery(document).ready(function(s){var a=wp.i18n.__,r=s(".tutor-search-loader"),o=s(".tutor-search-result"),u=s(".tutor-search-selected"),n=s("input.tutor-search-input"),t=s("#tutor-manual-enrollment-form"),e=s("#enrollment-modal"),i=s('select[name="course_id"]'),d=s(".tutor-btn-submit");function l(){var t=[];return u.find("[data-user-id]").each(function(){t.push(s(this).data("user-id"))}),t}n.keyup(function(a){var s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500,r=null;return function(){var t=this,e=arguments;clearTimeout(r),r=setTimeout(function(){a.apply(t,e)},s)}}(function(){var t=s(this).val();if(""===t)return o.html(""),void r.removeClass("is-loading");r.addClass("is-loading");var e=[],a=(u.find("[data-user-id]").each(function(){e.push(s(this).data("user-id"))}),s('select[name="course_id"]').val());s.ajax({url:window._tutorobject.ajaxurl,type:"POST",dataType:"json",data:{term:t,action:"tutor_search_students",course_id:a,shortlisted:e},success:function(t){r.removeClass("is-loading"),o.show(),o.html(t.data)}})},200)),e.on("click",".tutor-add-student",function(){var t,e;s(".tutor-add-student").hasClass("is-loading")||(s(this).addClass("is-loading"),s(".tutor-add-student").css("pointer-events","none"),t=s(this).data("user_id"),e=l(),t&&!isNaN(t)&&e.push(t),s.ajax({url:window._tutorobject.ajaxurl,type:"POST",dataType:"json",data:{action:"tutor_search_students",selection:1,shortlisted:e},success:function(t){r.removeClass("is-loading"),u.html(t.data),o.hide(),n.val("").focus(),s(".tutor-add-student").css("pointer-events","auto")}}))}),e.on("click",".tutor-btn-remove-student",function(){s(this).parent().closest(".tutor-user-item").remove()}),i.change(function(){""===s(this).val()?n.attr("disabled","disabled"):(n.removeAttr("disabled").focus(),u.empty())}),t.submit(function(t){t.preventDefault();var t=i.val(),e=l();t?0==e.length?tutor_toast(a("Error!","tutor-pro"),"Please select student for enroll","error"):(d.addClass("is-loading").attr("disabled","disabled"),s.ajax({url:window._tutorobject.ajaxurl,type:"POST",dataType:"json",data:{action:"tutor_enroll_bulk_student",course_id:t,student_ids:e.join(",")},success:function(t){d.removeClass("is-loading").removeAttr("disabled"),t.success?(s("button[data-tutor-modal-close]").last().click(),tutor_toast(a("Success","tutor-pro"),t.message,"success"),window.location.reload()):tutor_toast(a("Error!","tutor-pro"),t.message,"error")}})):tutor_toast(a("Error!","tutor-pro"),"Please select a course","error")}),s("#select2_search_user_ajax").select2({allowClear:!0,minimumInputLength:1,placeholder:a("Search students","tutor-pro"),language:{inputTooShort:function(){return a("Please add 1 or more character","tutor")}},escapeMarkup:function(t){return t},ajax:{url:window._tutorobject.ajaxurl,type:"POST",dataType:"json",delay:1e3,data:function(t){return{term:t.term,action:"tutor_json_search_students"}},processResults:function(t){var a=[];return t&&s.each(t,function(t,e){a.push({id:t,text:e})}),{results:a}},cache:!0}})});